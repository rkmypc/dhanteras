<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>धनतेरस की शुभकामनाएँ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:ital@0;1&display=swap');

        body {
            margin: 0;
            padding: 0;
            font-family: 'Tiro Devanagari Hindi', serif;
            background: linear-gradient(160deg, #6a0909 0%, #b48608 100%);
            color: #333;
            overflow-x: hidden;
            text-align: center;
        }

        .ad-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 0;
            background-color: rgba(0, 0, 0, 0.2);
            min-height: 60px;
        }

        .container {
            max-width: 600px;
            margin: 15px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            color: #c88d07;
            font-size: 2.8em;
            font-weight: bold;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            margin-bottom: 15px;
        }

        .greeting-gif {
            max-width: 80%;
            height: auto;
            border-radius: 10px;
            border: 4px solid #c88d07;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .message-box {
            background-color: #fffaf0;
            border-left: 5px solid #c88d07;
            padding: 10px 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }

        .message-box p {
            font-size: 1.3em;
            line-height: 1.7;
            color: #594500;
            margin: 10px 0;
        }

        .sender-info-box {
            margin: 30px 0;
            padding: 20px;
            background-color: #fff8e1;
            border-radius: 10px;
            border: 2px dashed #c88d07;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .sender-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid #c88d07;
            object-fit: cover;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .sender-name {
            font-size: 1.8em;
            font-weight: bold;
            color: #8B4513;
        }

        .personalize-section {
            margin-top: 30px;
            padding: 25px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border-top: 5px solid #c88d07;
        }

        h2 { color: #8B4513; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }

        .input-group input[type="text"] {
            width: calc(100% - 24px); padding: 12px; border-radius: 8px;
            border: 1px solid #ccc; font-family: 'Tiro Devanagari Hindi', serif; font-size: 1.1em;
        }

        .file-input-wrapper {
            position: relative; overflow: hidden; display: inline-block; cursor: pointer;
            background-color: #f0ad4e; color: white; padding: 10px 20px;
            border-radius: 8px; font-size: 1em; margin: 10px 0;
        }
        .file-input-wrapper input[type=file] {
            position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
        }
        #fileNameDisplay { font-style: italic; color: #555; display: block; margin-top: 5px; }
        
        #photoPreview {
            width: 80px; height: 80px; border-radius: 50%; margin-top: 10px;
            border: 2px solid #c88d07; object-fit: cover; display: none;
        }

        .share-button {
            display: inline-block; background: linear-gradient(45deg, #25D366, #128C7E);
            color: white; padding: 15px 30px; border-radius: 30px;
            text-decoration: none; font-size: 1.3em; font-weight: bold;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2); transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 15px; border: none; cursor: pointer;
        }
        .share-button:disabled { background: #ccc; cursor: not-allowed; }
        
        #loader { display: none; margin-top: 10px; color: #8B4513; }

        .creator { margin-top: 30px; font-size: 0.9em; color: #eee; text-shadow: 1px 1px 2px black; }

        .coin {
            position: fixed; top: -50px; font-size: 25px; color: gold;
            animation: fall linear forwards; z-index: 1; text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        @keyframes fall { to { transform: translateY(105vh); opacity: 0; } }
    </style>
</head>
<body>

    <!-- Top Ad -->
    <div class="ad-container">
        <script type="text/javascript">
            atOptions = { 'key' : '738665f713380a8ddde9b8a6af8bec3f', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/738665f713380a8ddde9b8a6af8bec3f/invoke.js"></script>
    </div>

    <div class="container">
        <h1>शुभ धनतेरस</h1>
        <img src="Dhanteras.gif" alt="Dhanteras Wishes" class="greeting-gif">

        <div class="message-box">
            <p>धन की वर्षा हो इतनी की,<br>हर जगह आपका नाम हो,<br>दिन रात आपको व्यापार में लाभ हो,<br>यह धनतेरस आपके लिए खास हो।</p>
            <p><strong>आपको और आपके परिवार को धनतेरस की हार्दिक शुभकामनाएँ!</strong></p>
        </div>

        <div class="sender-info-box">
            <img id="displayPhoto" src="https://i.ibb.co/7j5xXns/placeholder.png" alt="Sender's Photo" class="sender-photo">
            <div class="sender-name" id="displayName">आपको भेज रहा है</div>
        </div>

        <div class="personalize-section">
            <h2>यहाँ अपना नाम और फोटो डालकर शेयर करें</h2>
            <div class="input-group">
                <input type="text" id="userName" placeholder="यहाँ अपना नाम लिखें">
            </div>
            <div class="input-group">
                <div class="file-input-wrapper">
                    <span>फोटो चुनें</span>
                    <input type="file" id="userPhoto" accept="image/*">
                </div>
                <span id="fileNameDisplay"></span>
                <div><img id="photoPreview" src="#" alt="Your Photo Preview"/></div>
            </div>
            <button onclick="shareOnWhatsApp()" id="shareButton" class="share-button">
                <img src="https://img.icons8.com/color/28/000000/whatsapp--v1.png" style="vertical-align: middle; margin-right: 10px;"/>
                WhatsApp पर शेयर करें
            </button>
            <div id="loader">शेयर लिंक बना रहे हैं, कृपया प्रतीक्षा करें...</div>
        </div>
    </div>
    
    <p class="creator">Creator: Ritesh Kale -KHCA</p>

    <!-- Bottom Ad -->
    <div class="ad-container">
        <script type="text/javascript">
            atOptions = { 'key' : '738665f713380a8ddde9b8a6af8bec3f', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/738665f713380a8ddde9b8a6af8bec3f/invoke.js"></script>
    </div>

    <script>
        // --- Coin Animation ---
        setInterval(() => {
            const coin = document.createElement('div');
            coin.innerHTML = '₹';
            coin.classList.add('coin');
            coin.style.left = Math.random() * 100 + 'vw';
            coin.style.animationDuration = Math.random() * 3 + 4 + 's';
            document.body.appendChild(coin);
            setTimeout(() => { coin.remove(); }, 7000);
        }, 300);

        // --- Personalization and Sharing Logic ---
        const userPhotoInput = document.getElementById('userPhoto');
        const photoPreview = document.getElementById('photoPreview');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const defaultPhoto = "https://i.ibb.co/7j5xXns/placeholder.png";

        userPhotoInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoPreview.src = e.target.result;
                    photoPreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
                fileNameDisplay.textContent = file.name;
            }
        });

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name');
            const photoUrl = urlParams.get('photoUrl');

            document.getElementById('displayName').innerText = name ? ${decodeURIComponent(name)} की तरफ से : Ritesh Kale -KHCA की तरफ से;
            document.getElementById('displayPhoto').src = photoUrl ? decodeURIComponent(photoUrl) : defaultPhoto;
        };
        
        async function shareOnWhatsApp() {
            const userName = document.getElementById('userName').value;
            if (!userName) {
                alert('कृपया अपना नाम दर्ज करें!');
                return;
            }

            const shareButton = document.getElementById('shareButton');
            const loader = document.getElementById('loader');
            shareButton.disabled = true;
            loader.style.display = 'block';

            const photoFile = userPhotoInput.files[0];
            let finalPhotoUrl = defaultPhoto;

            if (photoFile) {
                // --- Step 1: Upload photo to ImgBB ---
                const apiKey = '20c36394a81552a1c6a235338600b46b'; // यह एक पब्लिक डेमो की है
                const formData = new FormData();
                formData.append('image', photoFile);

                try {
                    const response = await fetch(https://api.imgbb.com/1/upload?key=${apiKey}, {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        finalPhotoUrl = result.data.url;
                    } else {
                        throw new Error(result.error.message);
                    }
                } catch (error) {
                    alert('फोटो अपलोड नहीं हो सका। कृपया बाद में प्रयास करें।');
                    console.error('Upload Error:', error);
                    shareButton.disabled = false;
                    loader.style.display = 'none';
                    return;
                }
            }
            
            // --- Step 2: Generate and open WhatsApp link ---
            generateAndOpenLink(userName, finalPhotoUrl);
            
            shareButton.disabled = false;
            loader.style.display = 'none';
        }

        function generateAndOpenLink(name, photoUrl) {
            const baseUrl = window.location.href.split('?')[0];
            const newUrl = ${baseUrl}?name=${encodeURIComponent(name)}&photoUrl=${encodeURIComponent(photoUrl)};
            const message = ✨ *${name}* आपको धनतेरस की शुभकामनाएँ भेज रहे हैं! ✨\n\n🎁 अपनी व्यक्तिगत शुभकामनाएँ बनाने और साझा करने के लिए नीचे दिए गए लिंक पर क्लिक करें 👇\n\n${newUrl};
            const whatsappUrl = https://api.whatsapp.com/send?text=${encodeURIComponent(message)};
            window.open(whatsappUrl, '_blank');
        }
    </script>
</body>
</html>